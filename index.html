<!DOCTYPE html>

<html lang="th">
<head>
  <link rel="manifest" href="manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js').then(reg => {
        console.log('‚úÖ Service Worker ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß:', reg.scope);
      }).catch(err => {
        console.error('‚ùå Service Worker ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', err);
      });
    });
  }
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Stroke + ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    input, select, button, textarea { padding: 10px; font-size: 16px; margin: 10px 0; width: 100%; }
    h2 { text-align: center; }
    #result { margin-top: 20px; font-size: 18px; font-weight: bold; color: #2a7ae2; }
    .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 10px; }
    .edit-btn, .delete-btn { margin: 0 5px; font-size: 14px; padding: 5px 10px; cursor: pointer; }
    .nav { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .nav button { width: auto; padding: 10px 20px; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    table, th, td { border: 1px solid #999; }
    th, td { padding: 8px; text-align: center; }
    #searchInput, #searchCodeInput { width: 100%; margin-bottom: 10px; }

    /* Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡∏ô‡∏≤‡∏î A5 ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
    @media print {
      @page {
        size: A5 landscape;
        margin: 10mm;
      }
      body {
        font-family: sans-serif;
        font-size: 16px;
        color: #2a7ae2;
        padding: 20px;
      }
      #result {
        font-weight: normal;
        color: #2a7ae2;
      }
    }
  </style>
</head>
<body>
  <h2>üìÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Stroke + ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h2>

  <div class="nav">
    <button onclick="showSection('database')">üì¶ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button onclick="showSection('calculator')">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
  </div>

  <div id="database" class="section">
    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
    <input type="hidden" id="editIndex" value="" />
    <input type="text" id="newCode" placeholder="Prod Code" />
    <input type="text" id="newName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />
    <input type="text" id="newSteelGrade" placeholder="‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å (Steel Grade)" />
    <input type="number" id="newWeight" placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≠ Stroke (g)" step="any" />
    <input type="number" id="newPcs" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠ Stroke" />
    <input type="number" id="newSpm" placeholder="SPM (Speed Per Minute)" />
    <input type="number" id="newYield" placeholder="Yield (%)" />
    <input type="number" id="newRmw" placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô (Rmw) (g)" step="any" />
    <input type="number" id="newWidth" placeholder="‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å (mm)" step="any" />
    <input type="number" id="newThickness" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å (mm)" step="any" />
    <input type="number" id="newHeight" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (mm)" step="any" />
    <button onclick="saveProduct()">üìÇ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>

    <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="renderProductList()" />

    <table id="productTable"></table>
  </div>

  <div id="calculator" class="section hidden">
    <input type="text" id="searchCodeInput" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Prod Code)..." oninput="searchProdCode()" />

    <label for="productSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
    <select id="productSelect">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
    </select>

    <label>‚öñÔ∏è ‡∏õ‡πâ‡∏≠‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Order:</label>
    <input type="number" id="orderQty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (KGs / ‡∏ä‡∏¥‡πâ‡∏ô / SET)" step="any" />

    <label>üìè ‡∏´‡∏ô‡πà‡∏ß‡∏¢:</label>
    <select id="unitSelect">
      <option value="KGs">KGs</option>
      <option value="Pcs">Pcs</option>
      <option value="SET">SET</option>
    </select>

    <input type="number" id="pcsPerSet" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠ SET" style="display:none" />

    <label>üì¶ ‡∏õ‡πâ‡∏≠‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô WIP (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Order):</label>
    <input type="number" id="wipQty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô WIP ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà" step="any" value="0" />

    <input type="number" id="width" placeholder="‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å (mm)" style="display:none" />
    <input type="number" id="thickness" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å (mm)" style="display:none" />
    <input type="number" id="height" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (mm)" style="display:none" />

    <div id="autoFields" style="font-size: 14px; color: #444; margin-top: 10px;"></div>

    <button id="calculateBtn">üß≤ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
    <button id="printBtn" style="display:none;">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>

    <div id="result"></div>
  </div>

  <script>
    function showSection(sectionId) {
      document.getElementById('database').classList.add('hidden');
      document.getElementById('calculator').classList.add('hidden');
      document.getElementById(sectionId).classList.remove('hidden');
    }

    const products = JSON.parse(localStorage.getItem('products') || '[]');

    function renderProductList() {
      const table = document.getElementById('productTable');
      const search = document.getElementById('searchInput').value.toLowerCase();
      table.innerHTML = `
        <tr>
          <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th>‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å</th>
          <th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/Stroke</th>
          <th>‡∏ä‡∏¥‡πâ‡∏ô/Stroke</th>
          <th>SPM</th>
          <th>Yield (%)</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      `;
      products.forEach((p, i) => {
        if (p.name.toLowerCase().includes(search)) {
          table.innerHTML += `
            <tr>
              <td>${p.code || ''}</td>
              <td>${p.name}</td>
              <td>${p.steelGrade || ''}</td>
              <td>${p.weight}</td>
              <td>${p.pcs}</td>
              <td>${p.spm}</td>
              <td>${p.yield}</td>
              <td>
                <button onclick="editProduct(${i})">‚úèÔ∏è</button>
                <button onclick="deleteProduct(${i})">üóëÔ∏è</button>
              </td>
            </tr>
          `;
        }
      });
    }

    function saveProduct() {
      const code = document.getElementById('newCode').value.trim();
      const name = document.getElementById('newName').value.trim();
      if (!code || !name) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
      const data = {
        code,
        name,
        steelGrade: document.getElementById('newSteelGrade').value.trim(),
        weight: parseFloat(document.getElementById('newWeight').value) || 0,
        pcs: parseFloat(document.getElementById('newPcs').value) || 0,
        spm: parseFloat(document.getElementById('newSpm').value) || 0,
        yield: parseFloat(document.getElementById('newYield').value) || 0,
        rmw: parseFloat(document.getElementById('newRmw').value) || 0,
        width: parseFloat(document.getElementById('newWidth').value) || 0,
        thickness: parseFloat(document.getElementById('newThickness').value) || 0,
        height: parseFloat(document.getElementById('newHeight').value) || 0,
      };
      const idx = document.getElementById('editIndex').value;
      if (idx !== '') products[idx] = data;
      else products.push(data);
      localStorage.setItem('products', JSON.stringify(products));
      document.getElementById('editIndex').value = '';
      document.querySelectorAll('input').forEach(el => el.value = '');
      renderProductList();
      loadProductOptions();
    }

    function editProduct(i) {
      const p = products[i];
      document.getElementById('editIndex').value = i;
      document.getElementById('newCode').value = p.code || '';
      document.getElementById('newName').value = p.name;
      document.getElementById('newSteelGrade').value = p.steelGrade || '';
      document.getElementById('newWeight').value = p.weight;
      document.getElementById('newPcs').value = p.pcs;
      document.getElementById('newSpm').value = p.spm;
      document.getElementById('newYield').value = p.yield;
      document.getElementById('newRmw').value = p.rmw;
      document.getElementById('newWidth').value = p.width;
      document.getElementById('newThickness').value = p.thickness;
      document.getElementById('newHeight').value = p.height;
      showSection('database');
    }

    function deleteProduct(i) {
      if (!confirm('‡∏•‡∏ö‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°')) return;
      products.splice(i, 1);
      localStorage.setItem('products', JSON.stringify(products));
      renderProductList();
      loadProductOptions();
    }

    function loadProductOptions() {
      const select = document.getElementById('productSelect');
      select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>';
      products.forEach((p, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${p.code || ''} - ${p.name}`;
        select.appendChild(opt);
      });
    }

    function searchProdCode() {
      const code = document.getElementById('searchCodeInput').value.toLowerCase();
      const select = document.getElementById('productSelect');
      const found = [...select.options].find(opt => opt.textContent.toLowerCase().includes(code));
      if (found) {
        select.value = found.value;
        select.dispatchEvent(new Event('change'));
      }
    }

    document.getElementById('productSelect').addEventListener('change', function () {
      const i = this.value;
      if (!products[i]) return;
      const p = products[i];
      document.getElementById('autoFields').innerHTML = `
        ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/Stroke: ${p.weight}g<br>
        ‡∏ä‡∏¥‡πâ‡∏ô/Stroke: ${p.pcs}<br>
        SPM: ${p.spm}<br>
        Yield: ${p.yield}%<br>
        Rmw: ${p.rmw}g<br>
        ‡∏Ç‡∏ô‡∏≤‡∏î: W${p.width} x T${p.thickness} x H${p.height}<br>
        ‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å: ${p.steelGrade || '-'}
      `;
    });

    document.getElementById('unitSelect').addEventListener('change', function () {
      if (this.value === 'SET') {
        document.getElementById('pcsPerSet').style.display = 'block';
      } else {
        document.getElementById('pcsPerSet').style.display = 'none';
        document.getElementById('pcsPerSet').value = '';
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    function printResult() {
  const resultDiv = document.getElementById('result');
  const printWindow = window.open('', '', 'width=800,height=600');
  printWindow.document.write(`
    <html>
      <head>
        <title>‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå</title>
        <style>
          @page { size: A5 landscape; margin: 10mm; }
          body {
            font-family: sans-serif;
            font-size: 16px;
            padding: 20px;
            color: #2a7ae2;
          }
          h2 {
            text-align: center;
            margin-bottom: 20px;
          }
          p {
            margin: 10px 0;
          }
          .preview-container {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
          }
          .print-btn {
            display: block;
            margin: auto;
            padding: 10px 20px;
            background: #2a7ae2;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
          }
        </style>
      </head>
      <body>
        <h2>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Stroke‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ú‡∏•‡∏¥‡∏ï</h2>
        <div class="preview-container">
          ${resultDiv.innerHTML}
        </div>
        <button class="print-btn" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
      </body>
    </html>
  `);
  printWindow.document.close();
}

    document.getElementById('calculateBtn').addEventListener('click', () => {
      const idx = document.getElementById('productSelect').value;
      if (!products[idx]) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
        return;
      }
      const p = products[idx];
      let orderQty = parseFloat(document.getElementById('orderQty').value);
      let wipQty = parseFloat(document.getElementById('wipQty').value) || 0;
      const unit = document.getElementById('unitSelect').value;
      const pcsPerSet = parseFloat(document.getElementById('pcsPerSet').value) || 0;

      if (isNaN(orderQty) || orderQty <= 0) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Order ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }
      if (unit === 'SET' && pcsPerSet <= 0) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠ SET ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }

      let remainQty = orderQty - wipQty;
      if (remainQty < 0) remainQty = 0;

      let remainPcs;
      if (unit === 'KGs') {
        if (p.rmw === 0) {
          alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô (Rmw) ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢ KGs');
          return;
        }
        remainPcs = (remainQty * 1000) / p.weight;
      } else if (unit === 'Pcs') {
        remainPcs = remainQty;
      } else if (unit === 'SET') {
        remainPcs = (remainQty * pcsPerSet) / p.pcs;
      } else {
        remainPcs = 0;
      }

      let strokeCount = 0;
      if (p.pcs > 0) strokeCount = remainPcs;

      let rawMaterialKg = (strokeCount * p.rmw / 1000) * 1.02;

      let strokePerHour = p.spm * 0.7 * 60;

      let runningTimeHour = 0;
      if (strokePerHour > 0) runningTimeHour = strokeCount / strokePerHour;

      const hours = Math.floor(runningTimeHour);
      const minutes = Math.floor((runningTimeHour - hours) * 60);

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Order ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏•‡∏¥‡∏ï (‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å WIP): <strong>${remainQty.toFixed(2)} ${unit}</strong></p>
        <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Stroke ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°: <strong>${strokeCount.toFixed(2)} Stroke</strong></p>
        <p>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <strong>${rawMaterialKg.toFixed(3)} ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</strong></p>
        <p>‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡∏•‡∏¥‡∏ï: <strong>${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ</strong></p>
      `;

      // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à
      document.getElementById('printBtn').style.display = 'inline-block';
    });

    // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô printResult
    document.getElementById('printBtn').addEventListener('click', printResult);

    renderProductList();
    loadProductOptions();
  </script>

</body>
</html>
